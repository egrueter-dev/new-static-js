--- 
title:      "JavaScript-inside-Ruby syntax highlighting with TextMate"
created_at: 2009-02-25
outdated: true
kind: article
---
<p>If you had a look into the Netzke <a href='http://github.com/nomadcoder/netzke-core/tree/master'>code</a>, you’d see that for constructing JavaScript classes, a lot of the JavaScript code gets dynamically generated by Ruby. JavaScript code is mixed right into the Ruby functions. I adore the power of generating one dynamic language code with another dynamic language, however I didn’t feel comfortable <em>typing</em> JavaScript inside Ruby due the following reason: TextMate would neither highlight the JavaScript fragments, nor allow you to use the JavaScript-bundle goodies (like snippets) in it, as it “sees” the JavaScript code as simple Ruby strings. If you’d like to know how to reclaim that comfort - read on.</p>

<p>We want to modify the language grammar of the TextMate’s Ruby-on-Rails bundle, so that it could detect our JavaScript code and apply all the necessary rules and patterns. To make the detection of the JavaScript code easy, I chose for a convention to always wrap it up into the following Ruby construct, which defines a string:</p>

<pre><code><span class='punct'>&lt;&lt;-</span><span class='constant'>JS</span><span class='string'>
  // JavaScript code comes here
</span><span class='constant'>JS</span></code></pre>

<p>Now we only need to tell the Ruby-on-Rails bundle to find the code fragments limited by these 2 lines. To do this, open the TextMate bundle editor (by pressing ctrl+alt+command+B). Go to the Ruby-on-Rails bundle and select the Ruby-on-Rails language grammar (the item in the selector marked with the capital ‘L’). Find the section defining the parsing patterns, and insert the following piece:</p>

<pre><code><span class='punct'>{</span>  <span class='ident'>name</span> <span class='punct'>=</span> <span class='punct'>"</span><span class='string'>source.js</span><span class='punct'>";</span>
   <span class='keyword'>begin</span> <span class='punct'>=</span> <span class='punct'>"</span><span class='string'>&lt;&lt;-JS</span><span class='punct'>";</span>
   <span class='keyword'>end</span> <span class='punct'>=</span> <span class='punct'>"</span><span class='string'>JS</span><span class='punct'>";</span>
   <span class='ident'>patterns</span> <span class='punct'>=</span> <span class='punct'>(</span> <span class='punct'>{</span> <span class='ident'>include</span> <span class='punct'>=</span> <span class='punct'>"</span><span class='string'>source.js</span><span class='punct'>";</span> <span class='punct'>}</span> <span class='punct'>);</span>
<span class='punct'>},</span></code></pre>

<p>so that it looks like this:</p>

<p><img src='http://writelesscode.com/images/2009-02-25.jpg' alt='Bundle editor'/></p>

<p>And that’s all there’s to it.</p>
